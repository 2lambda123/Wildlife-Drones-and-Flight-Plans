import { Injectable } from '@angular/core';
import { Subject, Subscription } from 'rxjs';

@Injectable()
export class GeolocationService {
  protected subject = new Subject<Coordinates>();

  constructor() {
    this.startWatchingCoords();
  }

  protected startWatchingCoords() {
    navigator.geolocation.watchPosition(
      position => {
        this.subject.next(position.coords);
      },
      error => {
        this.subject.error(error);
      }
    );
  }

  subscribe(callback: (coords: Coordinates) => any): Subscription {
    return this.subject.subscribe(callback);
  }
}

@Injectable()
export class GeolocationMockService extends GeolocationService {
  protected startWatchingCoords() {
    let coordIndex = 0;
    setInterval(() => {
      const activeCoord = this.geolocationPath[coordIndex];

      this.subject.next({
        accuracy: 80 + (Math.random() - 0.5) * 100, // 80 - 150
        altitude: null,
        altitudeAccuracy: null,
        heading: null,
        latitude: activeCoord[1],
        longitude: activeCoord[0],
        speed: null,
      });

      coordIndex++;
      if (coordIndex === this.geolocationPath.length) {
        coordIndex = 0;
      }
    }, 4000);
  }

  // tslint:disable-next-line: member-ordering
  private geolocationPath = [
    [
      31.443901062011715,
      -25.42823749782356
    ],
    [
      31.443042755126953,
      -25.431648141963457
    ],
    [
      31.44355773925781,
      -25.433043377651206
    ],
    [
      31.44510269165039,
      -25.43707396776714
    ],
    [
      31.444759368896488,
      -25.43831412221137
    ],
    [
      31.44613265991211,
      -25.44172448109765
    ],
    [
      31.44750595092773,
      -25.44311960008277
    ],
    [
      31.45008087158203,
      -25.44513474341807
    ],
    [
      31.45179748535156,
      -25.44714985303186
    ],
    [
      31.452999114990234,
      -25.449939949130755
    ],
    [
      31.4564323425293,
      -25.450559961705494
    ],
    [
      31.459693908691403,
      -25.451024969041107
    ],
    [
      31.46209716796875,
      -25.452729980571352
    ],
    [
      31.46673202514648,
      -25.45443496795258
    ],
    [
      31.470508575439453,
      -25.456759911825234
    ],
    [
      31.473941802978516,
      -25.458619834588088
    ],
    [
      31.480121612548828,
      -25.460169748266555
    ],
    [
      31.487331390380856,
      -25.46171964198295
    ],
    [
      31.492481231689453,
      -25.46559428893416
    ],
    [
      31.499862670898438,
      -25.467299094062525
    ],
    [
      31.507930755615234,
      -25.46667916772013
    ],
    [
      31.514110565185543,
      -25.462029618330707
    ],
    [
      31.514968872070316,
      -25.45768987679958
    ],
    [
      31.512393951416016,
      -25.455209954233318
    ],
    [
      31.510848999023434,
      -25.451334972933665
    ],
    [
      31.51256561279297,
      -25.449319933363032
    ],
    [
      31.513595581054684,
      -25.44234453597513
    ],
    [
      31.514282226562496,
      -25.439244229665686
    ],
    [
      31.508960723876953,
      -25.437694046585214
    ],
    [
      31.504840850830078,
      -25.43707396776714
    ],
    [
      31.496601104736328,
      -25.435988822155203
    ],
    [
      31.491107940673825,
      -25.43242327489572
    ],
    [
      31.489906311035156,
      -25.427152272626365
    ],
    [
      31.487159729003903,
      -25.42188103981167
    ],
    [
      31.485271453857422,
      -25.420020549663356
    ],
    [
      31.471881866455075,
      -25.421726000062673
    ],
    [
      31.46484375,
      -25.421570960114266
    ],
    [
      31.460723876953125,
      -25.41722976060518
    ],
    [
      31.45488739013672,
      -25.416919668944416
    ],
    [
      31.453170776367188,
      -25.414128808110686
    ],
    [
      31.442699432373047,
      -25.412578301958998
    ],
    [
      31.442184448242188,
      -25.424051575359755
    ],
    [
      31.442184448242188,
      -25.4277724025071
    ]
  ];
}
