import { Injectable } from '@angular/core';
import { Subject, Subscription } from 'rxjs';

@Injectable()
export class GeolocationService {
  protected subject = new Subject<Coordinates>();

  constructor() {
    this.startWatchingCoords();
  }

  protected startWatchingCoords() {
    navigator.geolocation.watchPosition(
      position => {
        this.subject.next(position.coords);
      },
      error => {
        this.subject.error(error);
      }
    );
  }

  subscribe(callback: (coords: Coordinates) => any): Subscription {
    return this.subject.subscribe(callback);
  }
}

@Injectable()
export class GeolocationMockService extends GeolocationService {
  protected startWatchingCoords() {
    let coordIndex = 0;
    setInterval(() => {
      const activeCoord = this.geolocationPath[coordIndex];

      this.subject.next({
        accuracy: 80 + (Math.random() - 0.5) * 100, // 80 - 150
        altitude: null,
        altitudeAccuracy: null,
        heading: null,
        latitude: activeCoord[1],
        longitude: activeCoord[0],
        speed: null,
      });

      coordIndex++;
      if (coordIndex === this.geolocationPath.length) {
        coordIndex = 0;
      }
    }, 4000);
  }

  // tslint:disable-next-line: member-ordering
  private geolocationPath = [
    [
      28.265933990478516,
      -25.87250745620652
    ],
    [
      28.265633583068844,
      -25.873472797813868
    ],
    [
      28.264946937561035,
      -25.87436090512576
    ],
    [
      28.264689445495605,
      -25.875055940973393
    ],
    [
      28.26486110687256,
      -25.87578958548715
    ],
    [
      28.264989852905273,
      -25.87617571234842
    ],
    [
      28.26503276824951,
      -25.876446000400303
    ],
    [
      28.26529026031494,
      -25.87687073751793
    ],
    [
      28.26529026031494,
      -25.877604370760107
    ],
    [
      28.26481819152832,
      -25.877874655542787
    ],
    [
      28.264174461364746,
      -25.87814493970695
    ],
    [
      28.263702392578125,
      -25.878299387523054
    ],
    [
      28.263444900512695,
      -25.878955788488316
    ],
    [
      28.2637882232666,
      -25.879033011891458
    ],
    [
      28.264560699462887,
      -25.879148846901494
    ],
    [
      28.265376091003414,
      -25.879148846901494
    ],
    [
      28.266234397888184,
      -25.879496351249923
    ],
    [
      28.267436027526852,
      -25.880229968183283
    ],
    [
      28.267436027526852,
      -25.880616080528334
    ],
    [
      28.267993927001953,
      -25.881272468617773
    ],
    [
      28.268208503723145,
      -25.882314959849477
    ],
    [
      28.26979637145996,
      -25.88304855927353
    ],
    [
      28.27082633972168,
      -25.883936594583943
    ],
    [
      28.271126747131348,
      -25.88505628176059
    ],
    [
      28.27202796936035,
      -25.88633039563222
    ],
    [
      28.272414207458496,
      -25.886986751957803
    ],
    [
      28.272972106933594,
      -25.8881450189252
    ],
    [
      28.273744583129883,
      -25.889071624317346
    ],
    [
      28.273744583129883,
      -25.889727965403097
    ],
    [
      28.273873329162598,
      -25.890268478851333
    ],
    [
      28.274130821228027,
      -25.890654558370557
    ],
    [
      28.27460289001465,
      -25.89173557430671
    ],
    [
      28.27507495880127,
      -25.89192861182498
    ],
    [
      28.275718688964844,
      -25.892237471197568
    ],
    [
      28.276405334472653,
      -25.89246911519666
    ],
    [
      28.277392387390133,
      -25.8926621515153
    ],
    [
      28.278250694274902,
      -25.8926621515153
    ],
    [
      28.279452323913574,
      -25.892816580342906
    ],
    [
      28.280396461486816,
      -25.892816580342906
    ],
    [
      28.282756805419922,
      -25.89308683030505
    ],
    [
      28.283658027648926,
      -25.89339568664697
    ],
    [
      28.28425884246826,
      -25.893125437391987
    ],
    [
      28.285160064697266,
      -25.892083041612302
    ],
    [
      28.2857608795166,
      -25.891542536472766
    ],
    [
      28.28653335571289,
      -25.890615950475468
    ],
    [
      28.28803539276123,
      -25.890615950475468
    ],
    [
      28.288936614990234,
      -25.890268478851333
    ],
    [
      28.29056739807129,
      -25.889766573588606
    ],
    [
      28.2918119430542,
      -25.888994407479125
    ],
    [
      28.29292774200439,
      -25.888762756661396
    ],
    [
      28.29455852508545,
      -25.88833806231499
    ],
    [
      28.296189308166504,
      -25.887720322356582
    ],
    [
      28.2967472076416,
      -25.88737284220954
    ],
    [
      28.297476768493652,
      -25.886986751957803
    ],
    [
      28.297777175903317,
      -25.886986751957803
    ],
    [
      28.29803466796875,
      -25.886948142863186
    ],
    [
      28.298206329345703,
      -25.88683231550358
    ],
    [
      28.29799175262451,
      -25.886523441989098
    ],
    [
      28.29782009124756,
      -25.88629178632297
    ],
    [
      28.29726219177246,
      -25.885635426133945
    ],
    [
      28.296875953674313,
      -25.884747403599945
    ],
    [
      28.295888900756832,
      -25.884013814730107
    ],
    [
      28.29571723937988,
      -25.8829327280885
    ],
    [
      28.29524517059326,
      -25.88216051728475
    ],
    [
      28.2952880859375,
      -25.88169718837864
    ],
    [
      28.295674324035645,
      -25.88123385765468
    ],
    [
      28.295373916625977,
      -25.8804616357418
    ],
    [
      28.2952880859375,
      -25.879882465993433
    ],
    [
      28.295116424560547,
      -25.878569670715255
    ],
    [
      28.2952880859375,
      -25.877874655542787
    ],
    [
      28.295416831970215,
      -25.87710241166563
    ],
    [
      28.29606056213379,
      -25.876291550160666
    ],
    [
      28.29631805419922,
      -25.875866810960385
    ],
    [
      28.295931816101074,
      -25.875673747182645
    ],
    [
      28.295674324035645,
      -25.875673747182645
    ],
    [
      28.295373916625977,
      -25.875673747182645
    ],
    [
      28.29503059387207,
      -25.875673747182645
    ],
    [
      28.293485641479492,
      -25.87536484448192
    ],
    [
      28.291983604431152,
      -25.875287618680513
    ],
    [
      28.28958034515381,
      -25.87494010194945
    ],
    [
      28.287134170532227,
      -25.874283678668025
    ],
    [
      28.284902572631836,
      -25.873588638276672
    ],
    [
      28.28198432922363,
      -25.872854980093873
    ],
    [
      28.27880859375,
      -25.87188963343816
    ],
    [
      28.274731636047363,
      -25.87084705019033
    ],
    [
      28.27232837677002,
      -25.869997531112016
    ],
    [
      28.270225524902344,
      -25.86737170625347
    ],
    [
      28.26756477355957,
      -25.864861672063423
    ],
    [
      28.267135620117188,
      -25.864050726546093
    ],
    [
      28.266620635986325,
      -25.86327839230864
    ],
    [
      28.26584815979004,
      -25.86327839230864
    ],
    [
      28.26507568359375,
      -25.864205192787942
    ],
    [
      28.264775276184082,
      -25.864861672063423
    ],
    [
      28.26460361480713,
      -25.865633995954088
    ],
    [
      28.26460361480713,
      -25.86679247232623
    ],
    [
      28.265247344970703,
      -25.868761856094476
    ],
    [
      28.265504837036133,
      -25.871271807438937
    ],
    [
      28.26559066772461,
      -25.872121317354914
    ]
  ];
}
